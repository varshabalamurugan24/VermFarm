<!--<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VermaFarm - Smart Farming Marketplace</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
/* VermaFarm V2 - Enhanced Multi-User System Styles */

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    --primary: #2d5016;
    --secondary: #4a7c2c;
    --accent: #7cb342;
    --brown: #6d4c41;
    --light: #f1f8e9;
    --white: #ffffff;
    --gray: #757575;
    --dark: #1b3409;
    --danger: #d32f2f;
    --warning: #f57c00;
    --success: #388e3c;
    --info: #1976d2;
    --purple: #7b1fa2;
    --orange: #e65100;
    --border: #e0e0e0;
    --shadow: 0 2px 8px rgba(0,0,0,0.1);
    --shadow-lg: 0 4px 20px rgba(0,0,0,0.15);
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    line-height: 1.6;
    color: #333;
    background: #f5f5f5;
}

/* Utility Classes */
.container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px;
}

.hidden {
    display: none !important;
}

.btn {
    padding: 0.7rem 1.5rem;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    text-decoration: none;
    display: inline-block;
    text-align: center;
}

.btn-primary {
    background: var(--accent);
    color: white;
}

.btn-primary:hover {
    background: var(--secondary);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(74, 124, 44, 0.3);
}

.btn-secondary {
    background: var(--gray);
    color: white;
}

.btn-secondary:hover {
    background: #616161;
}

.btn-success {
    background: var(--success);
    color: white;
}

.btn-danger {
    background: var(--danger);
    color: white;
}

.btn-info {
    background: var(--info);
    color: white;
}

.btn-warning {
    background: var(--warning);
    color: white;
}

.btn-sm {
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
}

.btn-block {
    width: 100%;
    display: block;
}

.card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: var(--shadow);
    margin-bottom: 1.5rem;
}

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid var(--light);
}

.card-header h2 {
    color: var(--primary);
    font-size: 1.5rem;
}

.card-header h3 {
    color: var(--primary);
    font-size: 1.2rem;
}

/* Authentication Pages */
.auth-container {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    padding: 20px;
}

.auth-box {
    background: white;
    padding: 3rem;
    border-radius: 15px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    max-width: 500px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
}

.auth-logo {
    text-align: center;
    margin-bottom: 2rem;
}

.auth-logo h1 {
    color: var(--primary);
    font-size: 2rem;
    margin-bottom: 0.5rem;
}

.auth-logo .logo-icon {
    font-size: 3rem;
}

/* User Type Selection */
.user-type-selection {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.user-type-card {
    border: 3px solid var(--border);
    border-radius: 12px;
    padding: 1.2rem;
    cursor: pointer;
    transition: all 0.3s;
    background: white;
}

.user-type-card:hover {
    border-color: var(--accent);
    box-shadow: 0 4px 12px rgba(124, 179, 66, 0.2);
}

.user-type-card.selected {
    border-color: var(--accent);
    background: var(--light);
}

.user-type-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 0.5rem;
}

.user-type-icon {
    font-size: 2rem;
}

.user-type-title {
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--primary);
}

.user-type-description {
    font-size: 0.9rem;
    color: var(--gray);
    line-height: 1.4;
}

.user-type-features {
    list-style: none;
    margin-top: 0.5rem;
    font-size: 0.85rem;
    color: var(--gray);
}

.user-type-features li {
    padding: 0.2rem 0;
    padding-left: 1.2rem;
    position: relative;
}

.user-type-features li::before {
    content: '‚úì';
    position: absolute;
    left: 0;
    color: var(--success);
    font-weight: bold;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    color: var(--gray);
    font-weight: 500;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 0.8rem;
    border: 2px solid var(--border);
    border-radius: 8px;
    font-size: 1rem;
    transition: border-color 0.3s;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: var(--accent);
}

.form-group textarea {
    resize: vertical;
    min-height: 100px;
}

.alert {
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 1rem;
}

.alert-info {
    background: #e3f2fd;
    color: var(--info);
    border-left: 4px solid var(--info);
}

.alert-success {
    background: #e8f5e9;
    color: var(--success);
    border-left: 4px solid var(--success);
}

.alert-danger {
    background: #ffebee;
    color: var(--danger);
    border-left: 4px solid var(--danger);
}

.alert-warning {
    background: #fff3e0;
    color: var(--warning);
    border-left: 4px solid var(--warning);
}

/* App Layout */
.app-header {
    background: var(--primary);
    color: white;
    padding: 1rem 0;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header-logo {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 1.5rem;
    font-weight: bold;
}

.header-user {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.user-badge {
    background: var(--accent);
    padding: 0.4rem 1rem;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
}

/* Dashboard Navigation */
.dashboard-nav {
    background: white;
    border-radius: 12px;
    padding: 0.5rem;
    margin: 1.5rem 0;
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    box-shadow: var(--shadow);
}

.nav-tab {
    padding: 0.8rem 1.5rem;
    background: transparent;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s;
    color: var(--gray);
}

.nav-tab:hover {
    background: var(--light);
}

.nav-tab.active {
    background: var(--accent);
    color: white;
}

/* Dashboard Sections */
.dashboard-section {
    display: none;
}

.dashboard-section.active {
    display: block;
}

/* Stats Grid */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: linear-gradient(135deg, var(--accent) 0%, var(--secondary) 100%);
    color: white;
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: var(--shadow-lg);
}

.stat-card .icon {
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
}

.stat-card .label {
    font-size: 0.9rem;
    opacity: 0.9;
    margin-bottom: 0.3rem;
}

.stat-card .value {
    font-size: 2rem;
    font-weight: bold;
}

/* Table Styles */
.table-responsive {
    overflow-x: auto;
}

table {
    width: 100%;
    border-collapse: collapse;
}

thead {
    background: var(--light);
}

th, td {
    padding: 1rem;
    text-align: left;
    border-bottom: 1px solid var(--border);
}

th {
    font-weight: 600;
    color: var(--primary);
}

tbody tr:hover {
    background: var(--light);
}

/* Badge Styles */
.badge {
    display: inline-block;
    padding: 0.3rem 0.8rem;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
}

.badge-pending {
    background: var(--warning);
    color: white;
}

.badge-active, .badge-in_progress {
    background: var(--info);
    color: white;
}

.badge-completed {
    background: var(--success);
    color: white;
}

.badge-sold_out, .badge-cancelled {
    background: var(--danger);
    color: white;
}

/* Modal Styles */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.6);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    padding: 20px;
}

.modal {
    background: white;
    border-radius: 15px;
    max-width: 600px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
}

.modal-header {
    padding: 1.5rem;
    border-bottom: 2px solid var(--light);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h2 {
    color: var(--primary);
    font-size: 1.5rem;
}

.modal-close {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--gray);
    padding: 0.2rem 0.5rem;
}

.modal-body {
    padding: 1.5rem;
}

.modal-footer {
    padding: 1.5rem;
    border-top: 2px solid var(--light);
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
}

/* Product Card */
.product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1.5rem;
}

.product-card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: var(--shadow);
    transition: transform 0.3s, box-shadow 0.3s;
}

.product-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-lg);
}

.product-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
}

.product-title {
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--primary);
    margin-bottom: 0.5rem;
}

.product-price {
    font-size: 1.5rem;
    font-weight: bold;
    color: var(--accent);
    margin: 0.5rem 0;
}

.product-quantity {
    color: var(--gray);
    font-size: 0.9rem;
}

.product-actions {
    margin-top: 1rem;
    display: flex;
    gap: 0.5rem;
}

/* Loading Spinner */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255,255,255,0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
}

.spinner {
    border: 4px solid var(--light);
    border-top: 4px solid var(--accent);
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Responsive Design */
@media (max-width: 768px) {
    .header-content {
        flex-direction: column;
        gap: 1rem;
    }

    .dashboard-nav {
        flex-direction: column;
    }

    .stats-grid {
        grid-template-columns: 1fr;
    }

    .product-grid {
        grid-template-columns: 1fr;
    }

    .modal {
        margin: 10px;
    }
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: 3rem;
    color: var(--gray);
}

.empty-state-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
    opacity: 0.5;
}

.empty-state p {
    font-size: 1.1rem;
}
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
// ==============================================
// BACKEND API INTEGRATION - VermaFarm
// ==============================================

// API Configuration
const API_CONFIG = {
    BASE_URL: 'http://localhost:5000',  // Backend base URL (routes already include /api)
    ENDPOINTS: {
        // Auth
        REGISTER: '/auth/register',
        LOGIN: '/auth/login',
        LOGOUT: '/auth/logout',
        GET_ME: '/auth/me',
        UPDATE_DETAILS: '/auth/updatedetails',
        UPDATE_PASSWORD: '/auth/updatepassword',
        
        // Inventory
        GET_INVENTORY: '/inventory',
        UPDATE_INVENTORY: '/inventory/:id',
        BULK_UPDATE_INVENTORY: '/inventory/bulk',
        
        // Marketplace
        GET_LISTINGS: '/marketplace',
        CREATE_LISTING: '/marketplace',
        GET_MY_LISTINGS: '/marketplace/my-listings',
        UPDATE_LISTING: '/marketplace/:id',
        DELETE_LISTING: '/marketplace/:id',
        
        // Service Requests
        CREATE_SERVICE_REQUEST: '/service-requests',
        GET_AVAILABLE_REQUESTS: '/service-requests/available',
        GET_MY_REQUESTS: '/service-requests/my-requests',
        ACCEPT_SERVICE_REQUEST: '/service-requests/:id/accept',
        START_PROJECT: '/service-requests/:id/start',
        COMPLETE_PROJECT: '/service-requests/:id/complete',
        CANCEL_SERVICE_REQUEST: '/service-requests/:id/cancel'
    }
};

// API Helper Class
class API {
    static async request(endpoint, options = {}) {
        const token = localStorage.getItem('authToken');
        const url = `${API_CONFIG.BASE_URL}${endpoint}`;
        
        const config = {
            ...options,
            headers: {
                'Content-Type': 'application/json',
                ...(token ? { 'Authorization': `Bearer ${token}` } : {}),
                ...options.headers
            }
        };

        try {
            const response = await fetch(url, config);
            const data = await response.json();
            
            if (!response.ok) {
                throw new Error(data.message || 'API request failed');
            }
            
            return data;
        } catch (error) {
            console.error('API Error:', error);
            throw error;
        }
    }

    // Auth Methods
    static async register(userData) {
        return this.request(API_CONFIG.ENDPOINTS.REGISTER, {
            method: 'POST',
            body: JSON.stringify(userData)
        });
    }

    static async login(credentials) {
        return this.request(API_CONFIG.ENDPOINTS.LOGIN, {
            method: 'POST',
            body: JSON.stringify(credentials)
        });
    }

    static async logout() {
        return this.request(API_CONFIG.ENDPOINTS.LOGOUT);
    }

    static async getMe() {
        return this.request(API_CONFIG.ENDPOINTS.GET_ME);
    }

    static async updateDetails(details) {
        return this.request(API_CONFIG.ENDPOINTS.UPDATE_DETAILS, {
            method: 'PUT',
            body: JSON.stringify(details)
        });
    }

    // Inventory Methods
    static async getInventory() {
        return this.request(API_CONFIG.ENDPOINTS.GET_INVENTORY);
    }

    static async updateInventory(id, data) {
        const endpoint = API_CONFIG.ENDPOINTS.UPDATE_INVENTORY.replace(':id', id);
        return this.request(endpoint, {
            method: 'PUT',
            body: JSON.stringify(data)
        });
    }

    static async bulkUpdateInventory(items) {
        return this.request(API_CONFIG.ENDPOINTS.BULK_UPDATE_INVENTORY, {
            method: 'PUT',
            body: JSON.stringify(items)
        });
    }

    // Marketplace Methods
    static async getListings() {
        return this.request(API_CONFIG.ENDPOINTS.GET_LISTINGS);
    }

    static async createListing(listing) {
        return this.request(API_CONFIG.ENDPOINTS.CREATE_LISTING, {
            method: 'POST',
            body: JSON.stringify(listing)
        });
    }

    static async getMyListings() {
        return this.request(API_CONFIG.ENDPOINTS.GET_MY_LISTINGS);
    }

    static async updateListing(id, data) {
        const endpoint = API_CONFIG.ENDPOINTS.UPDATE_LISTING.replace(':id', id);
        return this.request(endpoint, {
            method: 'PUT',
            body: JSON.stringify(data)
        });
    }

    static async deleteListing(id) {
        const endpoint = API_CONFIG.ENDPOINTS.DELETE_LISTING.replace(':id', id);
        return this.request(endpoint, {
            method: 'DELETE'
        });
    }

    // Service Request Methods
    static async createServiceRequest(request) {
        return this.request(API_CONFIG.ENDPOINTS.CREATE_SERVICE_REQUEST, {
            method: 'POST',
            body: JSON.stringify(request)
        });
    }

    static async getAvailableRequests() {
        return this.request(API_CONFIG.ENDPOINTS.GET_AVAILABLE_REQUESTS);
    }

    static async getMyRequests() {
        return this.request(API_CONFIG.ENDPOINTS.GET_MY_REQUESTS);
    }

    static async acceptServiceRequest(id) {
        const endpoint = API_CONFIG.ENDPOINTS.ACCEPT_SERVICE_REQUEST.replace(':id', id);
        return this.request(endpoint, {
            method: 'PUT'
        });
    }

    static async startProject(id) {
        const endpoint = API_CONFIG.ENDPOINTS.START_PROJECT.replace(':id', id);
        return this.request(endpoint, {
            method: 'PUT'
        });
    }

    static async completeProject(id) {
        const endpoint = API_CONFIG.ENDPOINTS.COMPLETE_PROJECT.replace(':id', id);
        return this.request(endpoint, {
            method: 'PUT'
        });
    }

    static async cancelServiceRequest(id) {
        const endpoint = API_CONFIG.ENDPOINTS.CANCEL_SERVICE_REQUEST.replace(':id', id);
        return this.request(endpoint, {
            method: 'PUT'
        });
    }
}

// Main App Class
class VermaFarmApp {
    constructor() {
        this.currentUser = null;
        this.currentView = 'login';
        this.init();
    }

    async init() {
        // Check if user is already logged in
        const token = localStorage.getItem('authToken');
        if (token) {
            try {
                await this.loadCurrentUser();
                this.showDashboard();
            } catch (error) {
                console.error('Failed to load user:', error);
                localStorage.removeItem('authToken');
                this.showLogin();
            }
        } else {
            this.showLogin();
        }
    }

    async loadCurrentUser() {
        try {
            const response = await API.getMe();
            this.currentUser = response.data;
        } catch (error) {
            throw error;
        }
    }

    showLogin() {
        this.currentView = 'login';
        this.render();
    }

    showRegister() {
        this.currentView = 'register';
        this.render();
    }

    showDashboard() {
        this.currentView = 'dashboard';
        this.render();
    }

    render() {
        const app = document.getElementById('app');
        
        if (this.currentView === 'login') {
            app.innerHTML = this.renderLogin();
            this.attachLoginListeners();
        } else if (this.currentView === 'register') {
            app.innerHTML = this.renderRegister();
            this.attachRegisterListeners();
        } else if (this.currentView === 'dashboard') {
            app.innerHTML = this.renderDashboard();
            this.attachDashboardListeners();
        }
    }

    renderLogin() {
        return `
            <div class="auth-container">
                <div class="auth-box">
                    <div class="auth-logo">
                        <div class="logo-icon">üå±</div>
                        <h1>VermaFarm</h1>
                        <p style="color: var(--gray);">Smart Farming Marketplace</p>
                    </div>
                    
                    <form id="loginForm">
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="loginEmail" required placeholder="Enter your email">
                        </div>
                        
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="loginPassword" required placeholder="Enter your password">
                        </div>
                        
                        <button type="submit" class="btn btn-primary btn-block">Login</button>
                    </form>
                    
                    <p style="text-align: center; margin-top: 1.5rem; color: var(--gray);">
                        Don't have an account? 
                        <a href="#" id="showRegisterLink" style="color: var(--accent); font-weight: 600;">Register here</a>
                    </p>
                    
                    <div id="loginAlert" style="margin-top: 1rem;"></div>
                </div>
            </div>
        `;
    }

    renderRegister() {
        return `
            <div class="auth-container">
                <div class="auth-box">
                    <div class="auth-logo">
                        <div class="logo-icon">üå±</div>
                        <h1>VermaFarm</h1>
                        <p style="color: var(--gray);">Create Your Account</p>
                    </div>
                    
                    <div class="user-type-selection">
                        <div class="user-type-card" data-type="farmer">
                            <div class="user-type-header">
                                <span class="user-type-icon">üßë‚Äçüåæ</span>
                                <span class="user-type-title">Farmer</span>
                            </div>
                            <p class="user-type-description">Manage your farm inventory and sell products</p>
                            <ul class="user-type-features">
                                <li>Track poultry & waste inventory</li>
                                <li>List products on marketplace</li>
                                <li>Create service requests</li>
                            </ul>
                        </div>
                        
                        <div class="user-type-card" data-type="landowner">
                            <div class="user-type-header">
                                <span class="user-type-icon">üè°</span>
                                <span class="user-type-title">Landowner</span>
                            </div>
                            <p class="user-type-description">Provide composting services and earn revenue</p>
                            <ul class="user-type-features">
                                <li>Accept service requests</li>
                                <li>Sell vermicompost</li>
                                <li>Earn service charges</li>
                            </ul>
                        </div>
                    </div>
                    
                    <form id="registerForm">
                        <input type="hidden" id="userType" value="">
                        
                        <div class="form-group">
                            <label>Full Name</label>
                            <input type="text" id="registerName" required placeholder="Enter your full name">
                        </div>
                        
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="registerEmail" required placeholder="Enter your email">
                        </div>
                        
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="registerPassword" required placeholder="Create a password">
                        </div>
                        
                        <div class="form-group">
                            <label>Phone</label>
                            <input type="tel" id="registerPhone" required placeholder="+91 XXXXXXXXXX">
                        </div>
                        
                        <div class="form-group">
                            <label>Location</label>
                            <input type="text" id="registerLocation" required placeholder="City, State">
                        </div>
                        
                        <button type="submit" class="btn btn-primary btn-block">Create Account</button>
                    </form>
                    
                    <p style="text-align: center; margin-top: 1.5rem; color: var(--gray);">
                        Already have an account? 
                        <a href="#" id="showLoginLink" style="color: var(--accent); font-weight: 600;">Login here</a>
                    </p>
                    
                    <div id="registerAlert" style="margin-top: 1rem;"></div>
                </div>
            </div>
        `;
    }

    renderDashboard() {
        const userType = this.currentUser?.userType || this.currentUser?.role || 'farmer';
        
        return `
            <header class="app-header">
                <div class="container">
                    <div class="header-content">
                        <div class="header-logo">
                            <span>üå±</span>
                            <span>VermaFarm</span>
                        </div>
                        <div class="header-user">
                            <div class="user-badge">${userType.toUpperCase()}</div>
                            <span>${this.currentUser?.name || 'User'}</span>
                            <button class="btn btn-sm btn-danger" id="logoutBtn">Logout</button>
                        </div>
                    </div>
                </div>
            </header>
            
            <div class="container">
                ${this.renderDashboardNav(userType)}
                ${this.renderDashboardContent(userType)}
            </div>
        `;
    }

    renderDashboardNav(userType) {
        const tabs = {
            farmer: [
                { id: 'inventory', label: 'üì¶ Inventory', icon: 'üì¶' },
                { id: 'myListings', label: 'üõí My Listings', icon: 'üõí' },
                { id: 'marketplace', label: 'üè™ Marketplace', icon: 'üè™' },
                { id: 'serviceRequests', label: 'ü§ù Service Requests', icon: 'ü§ù' }
            ],
            landowner: [
                { id: 'myListings', label: 'üõí My Listings', icon: 'üõí' },
                { id: 'marketplace', label: 'üè™ Marketplace', icon: 'üè™' },
                { id: 'availableRequests', label: 'üìã Available Requests', icon: 'üìã' },
                { id: 'myProjects', label: 'üöÄ My Projects', icon: 'üöÄ' }
            ]
        };

        const userTabs = tabs[userType] || tabs.farmer;
        
        return `
            <nav class="dashboard-nav">
                ${userTabs.map((tab, index) => `
                    <button class="nav-tab ${index === 0 ? 'active' : ''}" data-tab="${tab.id}">
                        ${tab.label}
                    </button>
                `).join('')}
            </nav>
        `;
    }

    renderDashboardContent(userType) {
        return `
            <div id="dashboardContent">
                <div class="loading-overlay">
                    <div class="spinner"></div>
                </div>
            </div>
        `;
    }

    attachLoginListeners() {
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            await this.handleLogin();
        });

        document.getElementById('showRegisterLink').addEventListener('click', (e) => {
            e.preventDefault();
            this.showRegister();
        });
    }

    attachRegisterListeners() {
        const userTypeCards = document.querySelectorAll('.user-type-card');
        userTypeCards.forEach(card => {
            card.addEventListener('click', () => {
                userTypeCards.forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
                document.getElementById('userType').value = card.dataset.type;
            });
        });

        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            await this.handleRegister();
        });

        document.getElementById('showLoginLink').addEventListener('click', (e) => {
            e.preventDefault();
            this.showLogin();
        });
    }

    attachDashboardListeners() {
        document.getElementById('logoutBtn').addEventListener('click', () => this.handleLogout());

        const navTabs = document.querySelectorAll('.nav-tab');
        navTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                navTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                this.loadDashboardSection(tab.dataset.tab);
            });
        });

        // Load first tab by default
        const firstTab = navTabs[0];
        if (firstTab) {
            this.loadDashboardSection(firstTab.dataset.tab);
        }
    }

    async handleLogin() {
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        
        try {
            const response = await API.login({ email, password });
            localStorage.setItem('authToken', response.token);
            await this.loadCurrentUser();
            this.showDashboard();
        } catch (error) {
            this.showAlert('loginAlert', error.message || 'Login failed', 'danger');
        }
    }

    async handleRegister() {
        const userType = document.getElementById('userType').value;
        
        if (!userType) {
            this.showAlert('registerAlert', 'Please select a user type', 'warning');
            return;
        }

        const userData = {
            name: document.getElementById('registerName').value,
            email: document.getElementById('registerEmail').value,
            password: document.getElementById('registerPassword').value,
            userType: userType,  // Backend expects 'userType' not 'role'
            phone: document.getElementById('registerPhone').value,
            location: document.getElementById('registerLocation').value
        };

        try {
            const response = await API.register(userData);
            localStorage.setItem('authToken', response.token);
            await this.loadCurrentUser();
            this.showDashboard();
        } catch (error) {
            this.showAlert('registerAlert', error.message || 'Registration failed', 'danger');
        }
    }

    async handleLogout() {
        try {
            await API.logout();
        } catch (error) {
            console.error('Logout error:', error);
        }
        
        localStorage.removeItem('authToken');
        this.currentUser = null;
        this.showLogin();
    }

    async loadDashboardSection(section) {
        const content = document.getElementById('dashboardContent');
        content.innerHTML = '<div class="loading-overlay"><div class="spinner"></div></div>';

        try {
            switch (section) {
                case 'inventory':
                    await this.loadInventorySection();
                    break;
                case 'myListings':
                    await this.loadMyListingsSection();
                    break;
                case 'marketplace':
                    await this.loadMarketplaceSection();
                    break;
                case 'serviceRequests':
                    await this.loadServiceRequestsSection();
                    break;
                case 'availableRequests':
                    await this.loadAvailableRequestsSection();
                    break;
                case 'myProjects':
                    await this.loadMyProjectsSection();
                    break;
            }
        } catch (error) {
            content.innerHTML = `
                <div class="alert alert-danger">
                    Failed to load section: ${error.message}
                </div>
            `;
        }
    }

    async loadInventorySection() {
        const response = await API.getInventory();
        const inventory = response.data || [];
        
        const content = document.getElementById('dashboardContent');
        content.innerHTML = `
            <div class="card">
                <div class="card-header">
                    <h2>üì¶ Inventory Management</h2>
                    <button class="btn btn-primary btn-sm" id="addInventoryBtn">Add Item</button>
                </div>
                
                ${inventory.length === 0 ? `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì¶</div>
                        <p>No inventory items yet. Add your first item!</p>
                    </div>
                ` : `
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>Quantity</th>
                                    <th>Unit</th>
                                    <th>Price</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${inventory.map(item => `
                                    <tr>
                                        <td>${item.product || item.name}</td>
                                        <td>${item.quantity}</td>
                                        <td>${item.unit}</td>
                                        <td>‚Çπ${item.price || 0}</td>
                                        <td>
                                            <button class="btn btn-sm btn-secondary" onclick="app.editInventoryItem('${item._id}')">Edit</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `}
            </div>
        `;
    }

    async loadMyListingsSection() {
        const response = await API.getMyListings();
        const listings = response.data || [];
        
        const content = document.getElementById('dashboardContent');
        content.innerHTML = `
            <div class="card">
                <div class="card-header">
                    <h2>üõí My Listings</h2>
                    <button class="btn btn-primary btn-sm" id="createListingBtn">Create Listing</button>
                </div>
                
                ${listings.length === 0 ? `
                    <div class="empty-state">
                        <div class="empty-state-icon">üõí</div>
                        <p>No listings yet. Create your first listing!</p>
                    </div>
                ` : `
                    <div class="product-grid">
                        ${listings.map(listing => `
                            <div class="product-card">
                                <div class="product-icon">${this.getProductIcon(listing.category)}</div>
                                <h3 class="product-title">${listing.title || listing.productName}</h3>
                                <div class="product-price">‚Çπ${listing.price || listing.pricePerUnit}/${listing.unit}</div>
                                <div class="product-quantity">Available: ${listing.quantity || listing.quantityAvailable} ${listing.unit}</div>
                                <p style="color: var(--gray); margin: 0.5rem 0;">${listing.description}</p>
                                <span class="badge badge-${listing.status}">${listing.status}</span>
                                <div class="product-actions">
                                    <button class="btn btn-sm btn-secondary btn-block" onclick="app.editListing('${listing._id}')">Edit</button>
                                    <button class="btn btn-sm btn-danger btn-block" onclick="app.deleteListing('${listing._id}')">Delete</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `}
            </div>
        `;

        document.getElementById('createListingBtn')?.addEventListener('click', () => this.showCreateListingModal());
    }

    async loadMarketplaceSection() {
        const response = await API.getListings();
        const listings = response.data || [];
        
        const content = document.getElementById('dashboardContent');
        content.innerHTML = `
            <div class="card">
                <div class="card-header">
                    <h2>üè™ Marketplace</h2>
                </div>
                
                ${listings.length === 0 ? `
                    <div class="empty-state">
                        <div class="empty-state-icon">üè™</div>
                        <p>No products available in marketplace</p>
                    </div>
                ` : `
                    <div class="product-grid">
                        ${listings.map(listing => `
                            <div class="product-card">
                                <div class="product-icon">${this.getProductIcon(listing.category)}</div>
                                <h3 class="product-title">${listing.title || listing.productName}</h3>
                                <div class="product-price">‚Çπ${listing.price || listing.pricePerUnit}/${listing.unit}</div>
                                <div class="product-quantity">Available: ${listing.quantity || listing.quantityAvailable} ${listing.unit}</div>
                                <p style="color: var(--gray); margin: 0.5rem 0;">${listing.description}</p>
                                <button class="btn btn-primary btn-sm btn-block" onclick="app.contactSeller('${listing._id}')">Contact Seller</button>
                            </div>
                        `).join('')}
                    </div>
                `}
            </div>
        `;
    }

    async loadServiceRequestsSection() {
        const response = await API.getMyRequests();
        const requests = response.data || [];
        
        const content = document.getElementById('dashboardContent');
        content.innerHTML = `
            <div class="card">
                <div class="card-header">
                    <h2>ü§ù My Service Requests</h2>
                    <button class="btn btn-primary btn-sm" id="createRequestBtn">Create Request</button>
                </div>
                
                ${requests.length === 0 ? `
                    <div class="empty-state">
                        <div class="empty-state-icon">ü§ù</div>
                        <p>No service requests yet. Create your first request!</p>
                    </div>
                ` : `
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Service Type</th>
                                    <th>Description</th>
                                    <th>Status</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${requests.map(req => `
                                    <tr>
                                        <td>${req.serviceType || req.materialType}</td>
                                        <td>${req.description || req.notes}</td>
                                        <td><span class="badge badge-${req.status}">${req.status}</span></td>
                                        <td>${new Date(req.createdAt).toLocaleDateString()}</td>
                                        <td>
                                            ${req.status === 'pending' ? `
                                                <button class="btn btn-sm btn-danger" onclick="app.cancelRequest('${req._id}')">Cancel</button>
                                            ` : ''}
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `}
            </div>
        `;

        document.getElementById('createRequestBtn')?.addEventListener('click', () => this.showCreateRequestModal());
    }

    async loadAvailableRequestsSection() {
        const response = await API.getAvailableRequests();
        const requests = response.data || [];
        
        const content = document.getElementById('dashboardContent');
        content.innerHTML = `
            <div class="card">
                <div class="card-header">
                    <h2>üìã Available Service Requests</h2>
                </div>
                
                ${requests.length === 0 ? `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <p>No available requests at the moment</p>
                    </div>
                ` : `
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Service Type</th>
                                    <th>Description</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${requests.map(req => `
                                    <tr>
                                        <td>${req.serviceType || req.materialType}</td>
                                        <td>${req.description || req.notes}</td>
                                        <td>${new Date(req.createdAt).toLocaleDateString()}</td>
                                        <td>
                                            <button class="btn btn-sm btn-success" onclick="app.acceptRequest('${req._id}')">Accept</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `}
            </div>
        `;
    }

    async loadMyProjectsSection() {
        const response = await API.getMyRequests();
        const projects = (response.data || []).filter(p => p.status !== 'pending');
        
        const content = document.getElementById('dashboardContent');
        content.innerHTML = `
            <div class="card">
                <div class="card-header">
                    <h2>üöÄ My Projects</h2>
                </div>
                
                ${projects.length === 0 ? `
                    <div class="empty-state">
                        <div class="empty-state-icon">üöÄ</div>
                        <p>No active projects yet</p>
                    </div>
                ` : `
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Service Type</th>
                                    <th>Status</th>
                                    <th>Started</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${projects.map(proj => `
                                    <tr>
                                        <td>${proj.serviceType || proj.materialType}</td>
                                        <td><span class="badge badge-${proj.status}">${proj.status}</span></td>
                                        <td>${new Date(proj.acceptedAt || proj.createdAt).toLocaleDateString()}</td>
                                        <td>
                                            ${proj.status === 'accepted' ? `
                                                <button class="btn btn-sm btn-info" onclick="app.startProject('${proj._id}')">Start</button>
                                            ` : proj.status === 'in_progress' ? `
                                                <button class="btn btn-sm btn-success" onclick="app.completeProject('${proj._id}')">Complete</button>
                                            ` : ''}
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `}
            </div>
        `;
    }

    showCreateListingModal() {
        const modalHTML = `
            <div class="modal-overlay" id="modalOverlay">
                <div class="modal">
                    <div class="modal-header">
                        <h2>Create Marketplace Listing</h2>
                        <button class="modal-close" id="modalClose">‚úï</button>
                    </div>
                    <div class="modal-body">
                        <form id="createListingForm">
                            <div class="form-group">
                                <label>Product Title</label>
                                <input type="text" id="listingTitle" required>
                            </div>
                            <div class="form-group">
                                <label>Category</label>
                                <select id="listingCategory" required>
                                    <option value="">Select category</option>
                                    <option value="vermicompost">Vermicompost</option>
                                    <option value="poultry_waste">Poultry Waste</option>
                                    <option value="coconut_husk">Coconut Husk</option>
                                    <option value="dry_leaves">Dry Leaves</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea id="listingDescription" required></textarea>
                            </div>
                            <div class="form-group">
                                <label>Quantity</label>
                                <input type="number" id="listingQuantity" required min="1">
                            </div>
                            <div class="form-group">
                                <label>Unit</label>
                                <select id="listingUnit" required>
                                    <option value="kg">kg</option>
                                    <option value="ton">ton</option>
                                    <option value="bag">bag</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Price per Unit (‚Çπ)</label>
                                <input type="number" id="listingPrice" required min="1">
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" id="modalCancel">Cancel</button>
                        <button class="btn btn-primary" id="modalSubmit">Create Listing</button>
                    </div>
                </div>
            </div>
        `;

        document.body.insertAdjacentHTML('beforeend', modalHTML);
        
        this.attachModalListeners(async () => {
            const listing = {
                title: document.getElementById('listingTitle').value,
                category: document.getElementById('listingCategory').value,
                description: document.getElementById('listingDescription').value,
                quantity: parseInt(document.getElementById('listingQuantity').value),
                unit: document.getElementById('listingUnit').value,
                price: parseInt(document.getElementById('listingPrice').value),
                status: 'active'
            };

            try {
                await API.createListing(listing);
                alert('Listing created successfully!');
                this.loadMyListingsSection();
            } catch (error) {
                alert('Failed to create listing: ' + error.message);
            }
        });
    }

    showCreateRequestModal() {
        const modalHTML = `
            <div class="modal-overlay" id="modalOverlay">
                <div class="modal">
                    <div class="modal-header">
                        <h2>Create Service Request</h2>
                        <button class="modal-close" id="modalClose">‚úï</button>
                    </div>
                    <div class="modal-body">
                        <form id="createRequestForm">
                            <div class="form-group">
                                <label>Service Type</label>
                                <input type="text" id="requestServiceType" required placeholder="e.g., Vermicomposting Service">
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea id="requestDescription" required placeholder="Describe your requirements..."></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" id="modalCancel">Cancel</button>
                        <button class="btn btn-primary" id="modalSubmit">Create Request</button>
                    </div>
                </div>
            </div>
        `;

        document.body.insertAdjacentHTML('beforeend', modalHTML);
        
        this.attachModalListeners(async () => {
            const request = {
                serviceType: document.getElementById('requestServiceType').value,
                description: document.getElementById('requestDescription').value
            };

            try {
                await API.createServiceRequest(request);
                alert('Service request created successfully!');
                this.loadServiceRequestsSection();
            } catch (error) {
                alert('Failed to create request: ' + error.message);
            }
        });
    }

    async acceptRequest(id) {
        if (!confirm('Accept this service request?')) return;
        
        try {
            await API.acceptServiceRequest(id);
            alert('Request accepted successfully!');
            this.loadAvailableRequestsSection();
        } catch (error) {
            alert('Failed to accept request: ' + error.message);
        }
    }

    async startProject(id) {
        if (!confirm('Start this project?')) return;
        
        try {
            await API.startProject(id);
            alert('Project started!');
            this.loadMyProjectsSection();
        } catch (error) {
            alert('Failed to start project: ' + error.message);
        }
    }

    async completeProject(id) {
        if (!confirm('Mark this project as completed?')) return;
        
        try {
            await API.completeProject(id);
            alert('Project completed!');
            this.loadMyProjectsSection();
        } catch (error) {
            alert('Failed to complete project: ' + error.message);
        }
    }

    async cancelRequest(id) {
        if (!confirm('Cancel this request?')) return;
        
        try {
            await API.cancelServiceRequest(id);
            alert('Request cancelled');
            this.loadServiceRequestsSection();
        } catch (error) {
            alert('Failed to cancel request: ' + error.message);
        }
    }

    async deleteListing(id) {
        if (!confirm('Delete this listing?')) return;
        
        try {
            await API.deleteListing(id);
            alert('Listing deleted successfully!');
            this.loadMyListingsSection();
        } catch (error) {
            alert('Failed to delete listing: ' + error.message);
        }
    }

    contactSeller(listingId) {
        alert('Contact seller feature coming soon! (Listing ID: ' + listingId + ')');
    }

    attachModalListeners(submitCallback) {
        const closeModal = () => {
            const overlay = document.getElementById('modalOverlay');
            if (overlay) overlay.remove();
        };

        document.getElementById('modalClose')?.addEventListener('click', closeModal);
        document.getElementById('modalCancel')?.addEventListener('click', closeModal);
        
        document.getElementById('modalSubmit')?.addEventListener('click', () => {
            submitCallback();
            closeModal();
        });

        document.getElementById('modalOverlay')?.addEventListener('click', (e) => {
            if (e.target.id === 'modalOverlay') closeModal();
        });
    }

    getProductIcon(category) {
        const icons = {
            'vermicompost': 'üå±',
            'poultry_waste': 'üêî',
            'coconut_husk': 'ü••',
            'dry_leaves': 'üçÇ',
            'default': 'üì¶'
        };
        return icons[category] || icons.default;
    }

    showAlert(elementId, message, type) {
        const alert = document.getElementById(elementId);
        if (!alert) return;
        
        alert.className = `alert alert-${type}`;
        alert.textContent = message;
        alert.style.display = 'block';
        
        setTimeout(() => {
            alert.style.display = 'none';
        }, 5000);
    }
}

// Initialize app
let app;
document.addEventListener('DOMContentLoaded', () => {
    app = new VermaFarmApp();
});
    </script>
</body>
</html>-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VermaFarm - Smart Farming Marketplace</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
/* VermaFarm V2 - Enhanced Multi-User System Styles */

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    --primary: #2d5016;
    --secondary: #4a7c2c;
    --accent: #7cb342;
    --brown: #6d4c41;
    --light: #f1f8e9;
    --white: #ffffff;
    --gray: #757575;
    --dark: #1b3409;
    --danger: #d32f2f;
    --warning: #f57c00;
    --success: #388e3c;
    --info: #1976d2;
    --purple: #7b1fa2;
    --orange: #e65100;
    --border: #e0e0e0;
    --shadow: 0 2px 8px rgba(0,0,0,0.1);
    --shadow-lg: 0 4px 20px rgba(0,0,0,0.15);
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    line-height: 1.6;
    color: #333;
    background: #f5f5f5;
}

/* Utility Classes */
.container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px;
}

.hidden {
    display: none !important;
}

.btn {
    padding: 0.7rem 1.5rem;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    text-decoration: none;
    display: inline-block;
    text-align: center;
}

.btn-primary {
    background: var(--accent);
    color: white;
}

.btn-primary:hover {
    background: var(--secondary);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(74, 124, 44, 0.3);
}

.btn-secondary {
    background: var(--gray);
    color: white;
}

.btn-secondary:hover {
    background: #616161;
}

.btn-success {
    background: var(--success);
    color: white;
}

.btn-danger {
    background: var(--danger);
    color: white;
}

.btn-info {
    background: var(--info);
    color: white;
}

.btn-warning {
    background: var(--warning);
    color: white;
}

.btn-sm {
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
}

.btn-block {
    width: 100%;
    display: block;
}

.card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: var(--shadow);
    margin-bottom: 1.5rem;
}

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid var(--light);
}

.card-header h2 {
    color: var(--primary);
    font-size: 1.5rem;
}

.card-header h3 {
    color: var(--primary);
    font-size: 1.2rem;
}

/* Authentication Pages */
.auth-container {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    padding: 20px;
}

.auth-box {
    background: white;
    padding: 3rem;
    border-radius: 15px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    max-width: 500px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
}

.auth-logo {
    text-align: center;
    margin-bottom: 2rem;
}

.auth-logo h1 {
    color: var(--primary);
    font-size: 2rem;
    margin-bottom: 0.5rem;
}

.auth-logo .logo-icon {
    font-size: 3rem;
}

/* User Type Selection */
.user-type-selection {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.user-type-card {
    border: 3px solid var(--border);
    border-radius: 12px;
    padding: 1.2rem;
    cursor: pointer;
    transition: all 0.3s;
    background: white;
}

.user-type-card:hover {
    border-color: var(--accent);
    box-shadow: 0 4px 12px rgba(124, 179, 66, 0.2);
}

.user-type-card.selected {
    border-color: var(--accent);
    background: var(--light);
}

.user-type-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 0.5rem;
}

.user-type-icon {
    font-size: 2rem;
}

.user-type-title {
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--primary);
}

.user-type-description {
    font-size: 0.9rem;
    color: var(--gray);
    line-height: 1.4;
}

.user-type-features {
    list-style: none;
    margin-top: 0.5rem;
    font-size: 0.85rem;
    color: var(--gray);
}

.user-type-features li {
    padding: 0.2rem 0;
    padding-left: 1.2rem;
    position: relative;
}

.user-type-features li::before {
    content: '‚úì';
    position: absolute;
    left: 0;
    color: var(--success);
    font-weight: bold;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    color: var(--gray);
    font-weight: 500;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 0.8rem;
    border: 2px solid var(--border);
    border-radius: 8px;
    font-size: 1rem;
    transition: border-color 0.3s;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: var(--accent);
}

.form-group textarea {
    resize: vertical;
    min-height: 100px;
}

.alert {
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 1rem;
}

.alert-info {
    background: #e3f2fd;
    color: var(--info);
    border-left: 4px solid var(--info);
}

.alert-success {
    background: #e8f5e9;
    color: var(--success);
    border-left: 4px solid var(--success);
}

.alert-danger {
    background: #ffebee;
    color: var(--danger);
    border-left: 4px solid var(--danger);
}

.alert-warning {
    background: #fff3e0;
    color: var(--warning);
    border-left: 4px solid var(--warning);
}

/* App Layout */
.app-header {
    background: var(--primary);
    color: white;
    padding: 1rem 0;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header-logo {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 1.5rem;
    font-weight: bold;
}

.header-user {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.user-badge {
    background: var(--accent);
    padding: 0.4rem 1rem;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
}

/* Dashboard Navigation */
.dashboard-nav {
    background: white;
    border-radius: 12px;
    padding: 0.5rem;
    margin: 1.5rem 0;
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    box-shadow: var(--shadow);
}

.nav-tab {
    padding: 0.8rem 1.5rem;
    background: transparent;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s;
    color: var(--gray);
}

.nav-tab:hover {
    background: var(--light);
}

.nav-tab.active {
    background: var(--accent);
    color: white;
}

/* Dashboard Sections */
.dashboard-section {
    display: none;
}

.dashboard-section.active {
    display: block;
}

/* Stats Grid */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: linear-gradient(135deg, var(--accent) 0%, var(--secondary) 100%);
    color: white;
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: var(--shadow-lg);
}

.stat-card .icon {
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
}

.stat-card .label {
    font-size: 0.9rem;
    opacity: 0.9;
    margin-bottom: 0.3rem;
}

.stat-card .value {
    font-size: 2rem;
    font-weight: bold;
}

/* Table Styles */
.table-responsive {
    overflow-x: auto;
}

table {
    width: 100%;
    border-collapse: collapse;
}

thead {
    background: var(--light);
}

th, td {
    padding: 1rem;
    text-align: left;
    border-bottom: 1px solid var(--border);
}

th {
    font-weight: 600;
    color: var(--primary);
}

tbody tr:hover {
    background: var(--light);
}

/* Badge Styles */
.badge {
    display: inline-block;
    padding: 0.3rem 0.8rem;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
}

.badge-pending {
    background: var(--warning);
    color: white;
}

.badge-active, .badge-in_progress {
    background: var(--info);
    color: white;
}

.badge-completed {
    background: var(--success);
    color: white;
}

.badge-sold_out, .badge-cancelled {
    background: var(--danger);
    color: white;
}

/* Modal Styles */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.6);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    padding: 20px;
}

.modal {
    background: white;
    border-radius: 15px;
    max-width: 600px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
}

.modal-header {
    padding: 1.5rem;
    border-bottom: 2px solid var(--light);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h2 {
    color: var(--primary);
    font-size: 1.5rem;
}

.modal-close {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--gray);
    padding: 0.2rem 0.5rem;
}

.modal-body {
    padding: 1.5rem;
}

.modal-footer {
    padding: 1.5rem;
    border-top: 2px solid var(--light);
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
}

/* Product Card */
.product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1.5rem;
}

.product-card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: var(--shadow);
    transition: transform 0.3s, box-shadow 0.3s;
}

.product-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-lg);
}

.product-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
}

.product-title {
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--primary);
    margin-bottom: 0.5rem;
}

.product-price {
    font-size: 1.5rem;
    font-weight: bold;
    color: var(--accent);
    margin: 0.5rem 0;
}

.product-quantity {
    color: var(--gray);
    font-size: 0.9rem;
}

.product-actions {
    margin-top: 1rem;
    display: flex;
    gap: 0.5rem;
}

/* Loading Spinner */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255,255,255,0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
}

.spinner {
    border: 4px solid var(--light);
    border-top: 4px solid var(--accent);
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Responsive Design */
@media (max-width: 768px) {
    .header-content {
        flex-direction: column;
        gap: 1rem;
    }

    .dashboard-nav {
        flex-direction: column;
    }

    .stats-grid {
        grid-template-columns: 1fr;
    }

    .product-grid {
        grid-template-columns: 1fr;
    }

    .modal {
        margin: 10px;
    }
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: 3rem;
    color: var(--gray);
}

.empty-state-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
    opacity: 0.5;
}

.empty-state p {
    font-size: 1.1rem;
}
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
// ==============================================
// BACKEND API INTEGRATION - VermaFarm
// ==============================================

// API Configuration
const API_CONFIG = {
    BASE_URL: 'http://localhost:5000',  // Backend base URL (routes already include /api)
    ENDPOINTS: {
        // Auth
        REGISTER: '/api/auth/register',
        LOGIN: '/api/auth/login',
        LOGOUT: '/api/auth/logout',
        GET_ME: '/api/auth/me',
        UPDATE_DETAILS: '/api/auth/updatedetails',
        UPDATE_PASSWORD: '/api/auth/updatepassword',
        
        // Inventory
        GET_INVENTORY: '/api/inventory',
        UPDATE_INVENTORY: '/api/inventory/:id',
        BULK_UPDATE_INVENTORY: '/api/inventory/bulk',
        
        // Marketplace
        GET_LISTINGS: '/api/marketplace',
        CREATE_LISTING: '/api/marketplace',
        GET_MY_LISTINGS: '/api/marketplace/my-listings',
        UPDATE_LISTING: '/api/marketplace/:id',
        DELETE_LISTING: '/api/marketplace/:id',
        
        // Service Requests
        CREATE_SERVICE_REQUEST: '/api/service-requests',
        GET_AVAILABLE_REQUESTS: '/api/service-requests/available',
        GET_MY_REQUESTS: '/api/service-requests/my-requests',
        ACCEPT_SERVICE_REQUEST: '/api/service-requests/:id/accept',
        START_PROJECT: '/api/service-requests/:id/start',
        COMPLETE_PROJECT: '/api/service-requests/:id/complete',
        CANCEL_SERVICE_REQUEST: '/api/service-requests/:id/cancel'
    }
};

// API Helper Class
class API {
    static async request(endpoint, options = {}) {
        const token = localStorage.getItem('authToken');
        const url = `${API_CONFIG.BASE_URL}${endpoint}`;
        
        const config = {
            ...options,
            headers: {
                'Content-Type': 'application/json',
                ...(token ? { 'Authorization': `Bearer ${token}` } : {}),
                ...options.headers
            }
        };

        try {
            const response = await fetch(url, config);
            const data = await response.json();
            
            if (!response.ok) {
                throw new Error(data.message || 'API request failed');
            }
            
            return data;
        } catch (error) {
            console.error('API Error:', error);
            throw error;
        }
    }

    // Auth Methods
    static async register(userData) {
        return this.request(API_CONFIG.ENDPOINTS.REGISTER, {
            method: 'POST',
            body: JSON.stringify(userData)
        });
    }

    static async login(credentials) {
        return this.request(API_CONFIG.ENDPOINTS.LOGIN, {
            method: 'POST',
            body: JSON.stringify(credentials)
        });
    }

    static async logout() {
        return this.request(API_CONFIG.ENDPOINTS.LOGOUT);
    }

    static async getMe() {
        return this.request(API_CONFIG.ENDPOINTS.GET_ME);
    }

    static async updateDetails(details) {
        return this.request(API_CONFIG.ENDPOINTS.UPDATE_DETAILS, {
            method: 'PUT',
            body: JSON.stringify(details)
        });
    }

    // Inventory Methods
    static async getInventory() {
        return this.request(API_CONFIG.ENDPOINTS.GET_INVENTORY);
    }

    static async updateInventory(id, data) {
        const endpoint = API_CONFIG.ENDPOINTS.UPDATE_INVENTORY.replace(':id', id);
        return this.request(endpoint, {
            method: 'PUT',
            body: JSON.stringify(data)
        });
    }

    static async bulkUpdateInventory(items) {
        return this.request(API_CONFIG.ENDPOINTS.BULK_UPDATE_INVENTORY, {
            method: 'PUT',
            body: JSON.stringify(items)
        });
    }

    // Marketplace Methods
    static async getListings() {
        return this.request(API_CONFIG.ENDPOINTS.GET_LISTINGS);
    }

    static async createListing(listing) {
        return this.request(API_CONFIG.ENDPOINTS.CREATE_LISTING, {
            method: 'POST',
            body: JSON.stringify(listing)
        });
    }

    static async getMyListings() {
        return this.request(API_CONFIG.ENDPOINTS.GET_MY_LISTINGS);
    }

    static async updateListing(id, data) {
        const endpoint = API_CONFIG.ENDPOINTS.UPDATE_LISTING.replace(':id', id);
        return this.request(endpoint, {
            method: 'PUT',
            body: JSON.stringify(data)
        });
    }

    static async deleteListing(id) {
        const endpoint = API_CONFIG.ENDPOINTS.DELETE_LISTING.replace(':id', id);
        return this.request(endpoint, {
            method: 'DELETE'
        });
    }

    // Service Request Methods
    static async createServiceRequest(request) {
        return this.request(API_CONFIG.ENDPOINTS.CREATE_SERVICE_REQUEST, {
            method: 'POST',
            body: JSON.stringify(request)
        });
    }

    static async getAvailableRequests() {
        return this.request(API_CONFIG.ENDPOINTS.GET_AVAILABLE_REQUESTS);
    }

    static async getMyRequests() {
        return this.request(API_CONFIG.ENDPOINTS.GET_MY_REQUESTS);
    }

    static async acceptServiceRequest(id) {
        const endpoint = API_CONFIG.ENDPOINTS.ACCEPT_SERVICE_REQUEST.replace(':id', id);
        return this.request(endpoint, {
            method: 'PUT'
        });
    }

    static async startProject(id) {
        const endpoint = API_CONFIG.ENDPOINTS.START_PROJECT.replace(':id', id);
        return this.request(endpoint, {
            method: 'PUT'
        });
    }

    static async completeProject(id) {
        const endpoint = API_CONFIG.ENDPOINTS.COMPLETE_PROJECT.replace(':id', id);
        return this.request(endpoint, {
            method: 'PUT'
        });
    }

    static async cancelServiceRequest(id) {
        const endpoint = API_CONFIG.ENDPOINTS.CANCEL_SERVICE_REQUEST.replace(':id', id);
        return this.request(endpoint, {
            method: 'PUT'
        });
    }
}

// Main App Class
class VermaFarmApp {
    constructor() {
        this.currentUser = null;
        this.currentView = 'login';
        this.init();
    }

    async init() {
        // Check if user is already logged in
        const token = localStorage.getItem('authToken');
        if (token) {
            try {
                await this.loadCurrentUser();
                this.showDashboard();
            } catch (error) {
                console.error('Failed to load user:', error);
                localStorage.removeItem('authToken');
                this.showLogin();
            }
        } else {
            this.showLogin();
        }
    }

    async loadCurrentUser() {
        try {
            const response = await API.getMe();
            this.currentUser = response.data;
        } catch (error) {
            throw error;
        }
    }

    showLogin() {
        this.currentView = 'login';
        this.render();
    }

    showRegister() {
        this.currentView = 'register';
        this.render();
    }

    showDashboard() {
        this.currentView = 'dashboard';
        this.render();
    }

    render() {
        const app = document.getElementById('app');
        
        if (this.currentView === 'login') {
            app.innerHTML = this.renderLogin();
            this.attachLoginListeners();
        } else if (this.currentView === 'register') {
            app.innerHTML = this.renderRegister();
            this.attachRegisterListeners();
        } else if (this.currentView === 'dashboard') {
            app.innerHTML = this.renderDashboard();
            this.attachDashboardListeners();
        }
    }

    renderLogin() {
        return `
            <div class="auth-container">
                <div class="auth-box">
                    <div class="auth-logo">
                        <div class="logo-icon">üå±</div>
                        <h1>VermaFarm</h1>
                        <p style="color: var(--gray);">Smart Farming Marketplace</p>
                    </div>
                    
                    <form id="loginForm">
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="loginEmail" required placeholder="Enter your email">
                        </div>
                        
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="loginPassword" required placeholder="Enter your password">
                        </div>
                        
                        <button type="submit" class="btn btn-primary btn-block">Login</button>
                    </form>
                    
                    <p style="text-align: center; margin-top: 1.5rem; color: var(--gray);">
                        Don't have an account? 
                        <a href="#" id="showRegisterLink" style="color: var(--accent); font-weight: 600;">Register here</a>
                    </p>
                    
                    <div id="loginAlert" style="margin-top: 1rem;"></div>
                </div>
            </div>
        `;
    }

    renderRegister() {
        return `
            <div class="auth-container">
                <div class="auth-box">
                    <div class="auth-logo">
                        <div class="logo-icon">üå±</div>
                        <h1>VermaFarm</h1>
                        <p style="color: var(--gray);">Create Your Account</p>
                    </div>
                    
                    <div class="user-type-selection">
                        <div class="user-type-card" data-type="farmer">
                            <div class="user-type-header">
                                <span class="user-type-icon">üßë‚Äçüåæ</span>
                                <span class="user-type-title">Farmer</span>
                            </div>
                            <p class="user-type-description">Manage your farm inventory and sell products</p>
                            <ul class="user-type-features">
                                <li>Track poultry & waste inventory</li>
                                <li>List products on marketplace</li>
                                <li>Create service requests</li>
                            </ul>
                        </div>
                        
                        <div class="user-type-card" data-type="landowner">
                            <div class="user-type-header">
                                <span class="user-type-icon">üè°</span>
                                <span class="user-type-title">Landowner</span>
                            </div>
                            <p class="user-type-description">Provide composting services and earn revenue</p>
                            <ul class="user-type-features">
                                <li>Accept service requests</li>
                                <li>Sell vermicompost</li>
                                <li>Earn service charges</li>
                            </ul>
                        </div>
                    </div>
                    
                    <form id="registerForm">
                        <input type="hidden" id="userType" value="">
                        
                        <div class="form-group">
                            <label>Full Name</label>
                            <input type="text" id="registerName" required placeholder="Enter your full name">
                        </div>
                        
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="registerEmail" required placeholder="Enter your email">
                        </div>
                        
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="registerPassword" required placeholder="Create a password">
                        </div>
                        
                        <div class="form-group">
                            <label>Phone</label>
                            <input type="tel" id="registerPhone" required placeholder="+91 XXXXXXXXXX">
                        </div>
                        
                        <div class="form-group">
                            <label>Location</label>
                            <input type="text" id="registerLocation" required placeholder="City, State">
                        </div>
                        
                        <button type="submit" class="btn btn-primary btn-block">Create Account</button>
                    </form>
                    
                    <p style="text-align: center; margin-top: 1.5rem; color: var(--gray);">
                        Already have an account? 
                        <a href="#" id="showLoginLink" style="color: var(--accent); font-weight: 600;">Login here</a>
                    </p>
                    
                    <div id="registerAlert" style="margin-top: 1rem;"></div>
                </div>
            </div>
        `;
    }

    renderDashboard() {
        const userType = this.currentUser?.userType || this.currentUser?.role || 'farmer';
        
        return `
            <header class="app-header">
                <div class="container">
                    <div class="header-content">
                        <div class="header-logo">
                            <span>üå±</span>
                            <span>VermaFarm</span>
                        </div>
                        <div class="header-user">
                            <div class="user-badge">${userType.toUpperCase()}</div>
                            <span>${this.currentUser?.name || 'User'}</span>
                            <button class="btn btn-sm btn-danger" id="logoutBtn">Logout</button>
                        </div>
                    </div>
                </div>
            </header>
            
            <div class="container">
                ${this.renderDashboardNav(userType)}
                ${this.renderDashboardContent(userType)}
            </div>
        `;
    }

    renderDashboardNav(userType) {
        const tabs = {
            farmer: [
                { id: 'inventory', label: 'üì¶ Inventory', icon: 'üì¶' },
                { id: 'myListings', label: 'üõí My Listings', icon: 'üõí' },
                { id: 'marketplace', label: 'üè™ Marketplace', icon: 'üè™' },
                { id: 'serviceRequests', label: 'ü§ù Service Requests', icon: 'ü§ù' }
            ],
            landowner: [
                { id: 'myListings', label: 'üõí My Listings', icon: 'üõí' },
                { id: 'marketplace', label: 'üè™ Marketplace', icon: 'üè™' },
                { id: 'availableRequests', label: 'üìã Available Requests', icon: 'üìã' },
                { id: 'myProjects', label: 'üöÄ My Projects', icon: 'üöÄ' }
            ]
        };

        const userTabs = tabs[userType] || tabs.farmer;
        
        return `
            <nav class="dashboard-nav">
                ${userTabs.map((tab, index) => `
                    <button class="nav-tab ${index === 0 ? 'active' : ''}" data-tab="${tab.id}">
                        ${tab.label}
                    </button>
                `).join('')}
            </nav>
        `;
    }

    renderDashboardContent(userType) {
        return `
            <div id="dashboardContent">
                <div class="loading-overlay">
                    <div class="spinner"></div>
                </div>
            </div>
        `;
    }

    attachLoginListeners() {
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            await this.handleLogin();
        });

        document.getElementById('showRegisterLink').addEventListener('click', (e) => {
            e.preventDefault();
            this.showRegister();
        });
    }

    attachRegisterListeners() {
        const userTypeCards = document.querySelectorAll('.user-type-card');
        userTypeCards.forEach(card => {
            card.addEventListener('click', () => {
                userTypeCards.forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
                document.getElementById('userType').value = card.dataset.type;
            });
        });

        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            await this.handleRegister();
        });

        document.getElementById('showLoginLink').addEventListener('click', (e) => {
            e.preventDefault();
            this.showLogin();
        });
    }

    attachDashboardListeners() {
        document.getElementById('logoutBtn').addEventListener('click', () => this.handleLogout());

        const navTabs = document.querySelectorAll('.nav-tab');
        navTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                navTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                this.loadDashboardSection(tab.dataset.tab);
            });
        });

        // Load first tab by default
        const firstTab = navTabs[0];
        if (firstTab) {
            this.loadDashboardSection(firstTab.dataset.tab);
        }
    }

    async handleLogin() {
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        
        try {
            const response = await API.login({ email, password });
            localStorage.setItem('authToken', response.token);
            await this.loadCurrentUser();
            this.showDashboard();
        } catch (error) {
            this.showAlert('loginAlert', error.message || 'Login failed', 'danger');
        }
    }

    async handleRegister() {
        const userType = document.getElementById('userType').value;
        
        if (!userType) {
            this.showAlert('registerAlert', 'Please select a user type', 'warning');
            return;
        }

        const userData = {
            name: document.getElementById('registerName').value,
            email: document.getElementById('registerEmail').value,
            password: document.getElementById('registerPassword').value,
            userType: userType,  // Backend expects 'userType' not 'role'
            phone: document.getElementById('registerPhone').value,
            location: document.getElementById('registerLocation').value
        };

        try {
            const response = await API.register(userData);
            localStorage.setItem('authToken', response.token);
            await this.loadCurrentUser();
            this.showDashboard();
        } catch (error) {
            this.showAlert('registerAlert', error.message || 'Registration failed', 'danger');
        }
    }

    async handleLogout() {
        try {
            await API.logout();
        } catch (error) {
            console.error('Logout error:', error);
        }
        
        localStorage.removeItem('authToken');
        this.currentUser = null;
        this.showLogin();
    }

    async loadDashboardSection(section) {
        const content = document.getElementById('dashboardContent');
        content.innerHTML = '<div class="loading-overlay"><div class="spinner"></div></div>';

        try {
            switch (section) {
                case 'inventory':
                    await this.loadInventorySection();
                    break;
                case 'myListings':
                    await this.loadMyListingsSection();
                    break;
                case 'marketplace':
                    await this.loadMarketplaceSection();
                    break;
                case 'serviceRequests':
                    await this.loadServiceRequestsSection();
                    break;
                case 'availableRequests':
                    await this.loadAvailableRequestsSection();
                    break;
                case 'myProjects':
                    await this.loadMyProjectsSection();
                    break;
            }
        } catch (error) {
            content.innerHTML = `
                <div class="alert alert-danger">
                    Failed to load section: ${error.message}
                </div>
            `;
        }
    }

    async loadInventorySection() {
        const response = await API.getInventory();
        const inventory = response.data || [];
        
        const content = document.getElementById('dashboardContent');
        content.innerHTML = `
            <div class="card">
                <div class="card-header">
                    <h2>üì¶ Inventory Management</h2>
                    <button class="btn btn-primary btn-sm" id="addInventoryBtn">Add Item</button>
                </div>
                
                ${inventory.length === 0 ? `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì¶</div>
                        <p>No inventory items yet. Add your first item!</p>
                    </div>
                ` : `
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>Quantity</th>
                                    <th>Unit</th>
                                    <th>Price</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${inventory.map(item => `
                                    <tr>
                                        <td>${item.product || item.name}</td>
                                        <td>${item.quantity}</td>
                                        <td>${item.unit}</td>
                                        <td>‚Çπ${item.price || 0}</td>
                                        <td>
                                            <button class="btn btn-sm btn-secondary" onclick="app.editInventoryItem('${item._id}')">Edit</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `}
            </div>
        `;
    }

    async loadMyListingsSection() {
        const response = await API.getMyListings();
        const listings = response.data || [];
        
        const content = document.getElementById('dashboardContent');
        content.innerHTML = `
            <div class="card">
                <div class="card-header">
                    <h2>üõí My Listings</h2>
                    <button class="btn btn-primary btn-sm" id="createListingBtn">Create Listing</button>
                </div>
                
                ${listings.length === 0 ? `
                    <div class="empty-state">
                        <div class="empty-state-icon">üõí</div>
                        <p>No listings yet. Create your first listing!</p>
                    </div>
                ` : `
                    <div class="product-grid">
                        ${listings.map(listing => `
                            <div class="product-card">
                                <div class="product-icon">${this.getProductIcon(listing.category)}</div>
                                <h3 class="product-title">${listing.title || listing.productName}</h3>
                                <div class="product-price">‚Çπ${listing.price || listing.pricePerUnit}/${listing.unit}</div>
                                <div class="product-quantity">Available: ${listing.quantity || listing.quantityAvailable} ${listing.unit}</div>
                                <p style="color: var(--gray); margin: 0.5rem 0;">${listing.description}</p>
                                <span class="badge badge-${listing.status}">${listing.status}</span>
                                <div class="product-actions">
                                    <button class="btn btn-sm btn-secondary btn-block" onclick="app.editListing('${listing._id}')">Edit</button>
                                    <button class="btn btn-sm btn-danger btn-block" onclick="app.deleteListing('${listing._id}')">Delete</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `}
            </div>
        `;

        document.getElementById('createListingBtn')?.addEventListener('click', () => this.showCreateListingModal());
    }

    async loadMarketplaceSection() {
        const response = await API.getListings();
        const listings = response.data || [];
        
        const content = document.getElementById('dashboardContent');
        content.innerHTML = `
            <div class="card">
                <div class="card-header">
                    <h2>üè™ Marketplace</h2>
                </div>
                
                ${listings.length === 0 ? `
                    <div class="empty-state">
                        <div class="empty-state-icon">üè™</div>
                        <p>No products available in marketplace</p>
                    </div>
                ` : `
                    <div class="product-grid">
                        ${listings.map(listing => `
                            <div class="product-card">
                                <div class="product-icon">${this.getProductIcon(listing.category)}</div>
                                <h3 class="product-title">${listing.title || listing.productName}</h3>
                                <div class="product-price">‚Çπ${listing.price || listing.pricePerUnit}/${listing.unit}</div>
                                <div class="product-quantity">Available: ${listing.quantity || listing.quantityAvailable} ${listing.unit}</div>
                                <p style="color: var(--gray); margin: 0.5rem 0;">${listing.description}</p>
                                <button class="btn btn-primary btn-sm btn-block" onclick="app.contactSeller('${listing._id}')">Contact Seller</button>
                            </div>
                        `).join('')}
                    </div>
                `}
            </div>
        `;
    }

    async loadServiceRequestsSection() {
        const response = await API.getMyRequests();
        const requests = response.data || [];
        
        const content = document.getElementById('dashboardContent');
        content.innerHTML = `
            <div class="card">
                <div class="card-header">
                    <h2>ü§ù My Service Requests</h2>
                    <button class="btn btn-primary btn-sm" id="createRequestBtn">Create Request</button>
                </div>
                
                ${requests.length === 0 ? `
                    <div class="empty-state">
                        <div class="empty-state-icon">ü§ù</div>
                        <p>No service requests yet. Create your first request!</p>
                    </div>
                ` : `
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Service Type</th>
                                    <th>Description</th>
                                    <th>Status</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${requests.map(req => `
                                    <tr>
                                        <td>${req.serviceType || req.materialType}</td>
                                        <td>${req.description || req.notes}</td>
                                        <td><span class="badge badge-${req.status}">${req.status}</span></td>
                                        <td>${new Date(req.createdAt).toLocaleDateString()}</td>
                                        <td>
                                            ${req.status === 'pending' ? `
                                                <button class="btn btn-sm btn-danger" onclick="app.cancelRequest('${req._id}')">Cancel</button>
                                            ` : ''}
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `}
            </div>
        `;

        document.getElementById('createRequestBtn')?.addEventListener('click', () => this.showCreateRequestModal());
    }

    async loadAvailableRequestsSection() {
        const response = await API.getAvailableRequests();
        const requests = response.data || [];
        
        const content = document.getElementById('dashboardContent');
        content.innerHTML = `
            <div class="card">
                <div class="card-header">
                    <h2>üìã Available Service Requests</h2>
                </div>
                
                ${requests.length === 0 ? `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <p>No available requests at the moment</p>
                    </div>
                ` : `
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Service Type</th>
                                    <th>Description</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${requests.map(req => `
                                    <tr>
                                        <td>${req.serviceType || req.materialType}</td>
                                        <td>${req.description || req.notes}</td>
                                        <td>${new Date(req.createdAt).toLocaleDateString()}</td>
                                        <td>
                                            <button class="btn btn-sm btn-success" onclick="app.acceptRequest('${req._id}')">Accept</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `}
            </div>
        `;
    }

    async loadMyProjectsSection() {
        const response = await API.getMyRequests();
        const projects = (response.data || []).filter(p => p.status !== 'pending');
        
        const content = document.getElementById('dashboardContent');
        content.innerHTML = `
            <div class="card">
                <div class="card-header">
                    <h2>üöÄ My Projects</h2>
                </div>
                
                ${projects.length === 0 ? `
                    <div class="empty-state">
                        <div class="empty-state-icon">üöÄ</div>
                        <p>No active projects yet</p>
                    </div>
                ` : `
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Service Type</th>
                                    <th>Status</th>
                                    <th>Started</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${projects.map(proj => `
                                    <tr>
                                        <td>${proj.serviceType || proj.materialType}</td>
                                        <td><span class="badge badge-${proj.status}">${proj.status}</span></td>
                                        <td>${new Date(proj.acceptedAt || proj.createdAt).toLocaleDateString()}</td>
                                        <td>
                                            ${proj.status === 'accepted' ? `
                                                <button class="btn btn-sm btn-info" onclick="app.startProject('${proj._id}')">Start</button>
                                            ` : proj.status === 'in_progress' ? `
                                                <button class="btn btn-sm btn-success" onclick="app.completeProject('${proj._id}')">Complete</button>
                                            ` : ''}
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `}
            </div>
        `;
    }

    showCreateListingModal() {
        const modalHTML = `
            <div class="modal-overlay" id="modalOverlay">
                <div class="modal">
                    <div class="modal-header">
                        <h2>Create Marketplace Listing</h2>
                        <button class="modal-close" id="modalClose">‚úï</button>
                    </div>
                    <div class="modal-body">
                        <form id="createListingForm">
                            <div class="form-group">
                                <label>Product Title</label>
                                <input type="text" id="listingTitle" required>
                            </div>
                            <div class="form-group">
                                <label>Category</label>
                                <select id="listingCategory" required>
                                    <option value="">Select category</option>
                                    <option value="vermicompost">Vermicompost</option>
                                    <option value="poultry_waste">Poultry Waste</option>
                                    <option value="coconut_husk">Coconut Husk</option>
                                    <option value="dry_leaves">Dry Leaves</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea id="listingDescription" required></textarea>
                            </div>
                            <div class="form-group">
                                <label>Quantity</label>
                                <input type="number" id="listingQuantity" required min="1">
                            </div>
                            <div class="form-group">
                                <label>Unit</label>
                                <select id="listingUnit" required>
                                    <option value="kg">kg</option>
                                    <option value="ton">ton</option>
                                    <option value="bag">bag</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Price per Unit (‚Çπ)</label>
                                <input type="number" id="listingPrice" required min="1">
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" id="modalCancel">Cancel</button>
                        <button class="btn btn-primary" id="modalSubmit">Create Listing</button>
                    </div>
                </div>
            </div>
        `;

        document.body.insertAdjacentHTML('beforeend', modalHTML);
        
        this.attachModalListeners(async () => {
            const listing = {
                title: document.getElementById('listingTitle').value,
                category: document.getElementById('listingCategory').value,
                description: document.getElementById('listingDescription').value,
                quantity: parseInt(document.getElementById('listingQuantity').value),
                unit: document.getElementById('listingUnit').value,
                price: parseInt(document.getElementById('listingPrice').value),
                status: 'active'
            };

            try {
                await API.createListing(listing);
                alert('Listing created successfully!');
                this.loadMyListingsSection();
            } catch (error) {
                alert('Failed to create listing: ' + error.message);
            }
        });
    }

    showCreateRequestModal() {
        const modalHTML = `
            <div class="modal-overlay" id="modalOverlay">
                <div class="modal">
                    <div class="modal-header">
                        <h2>Create Service Request</h2>
                        <button class="modal-close" id="modalClose">‚úï</button>
                    </div>
                    <div class="modal-body">
                        <form id="createRequestForm">
                            <div class="form-group">
                                <label>Service Type</label>
                                <input type="text" id="requestServiceType" required placeholder="e.g., Vermicomposting Service">
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea id="requestDescription" required placeholder="Describe your requirements..."></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" id="modalCancel">Cancel</button>
                        <button class="btn btn-primary" id="modalSubmit">Create Request</button>
                    </div>
                </div>
            </div>
        `;

        document.body.insertAdjacentHTML('beforeend', modalHTML);
        
        this.attachModalListeners(async () => {
            const request = {
                serviceType: document.getElementById('requestServiceType').value,
                description: document.getElementById('requestDescription').value
            };

            try {
                await API.createServiceRequest(request);
                alert('Service request created successfully!');
                this.loadServiceRequestsSection();
            } catch (error) {
                alert('Failed to create request: ' + error.message);
            }
        });
    }

    async acceptRequest(id) {
        if (!confirm('Accept this service request?')) return;
        
        try {
            await API.acceptServiceRequest(id);
            alert('Request accepted successfully!');
            this.loadAvailableRequestsSection();
        } catch (error) {
            alert('Failed to accept request: ' + error.message);
        }
    }

    async startProject(id) {
        if (!confirm('Start this project?')) return;
        
        try {
            await API.startProject(id);
            alert('Project started!');
            this.loadMyProjectsSection();
        } catch (error) {
            alert('Failed to start project: ' + error.message);
        }
    }

    async completeProject(id) {
        if (!confirm('Mark this project as completed?')) return;
        
        try {
            await API.completeProject(id);
            alert('Project completed!');
            this.loadMyProjectsSection();
        } catch (error) {
            alert('Failed to complete project: ' + error.message);
        }
    }

    async cancelRequest(id) {
        if (!confirm('Cancel this request?')) return;
        
        try {
            await API.cancelServiceRequest(id);
            alert('Request cancelled');
            this.loadServiceRequestsSection();
        } catch (error) {
            alert('Failed to cancel request: ' + error.message);
        }
    }

    async deleteListing(id) {
        if (!confirm('Delete this listing?')) return;
        
        try {
            await API.deleteListing(id);
            alert('Listing deleted successfully!');
            this.loadMyListingsSection();
        } catch (error) {
            alert('Failed to delete listing: ' + error.message);
        }
    }

    contactSeller(listingId) {
        alert('Contact seller feature coming soon! (Listing ID: ' + listingId + ')');
    }

    attachModalListeners(submitCallback) {
        const closeModal = () => {
            const overlay = document.getElementById('modalOverlay');
            if (overlay) overlay.remove();
        };

        document.getElementById('modalClose')?.addEventListener('click', closeModal);
        document.getElementById('modalCancel')?.addEventListener('click', closeModal);
        
        document.getElementById('modalSubmit')?.addEventListener('click', () => {
            submitCallback();
            closeModal();
        });

        document.getElementById('modalOverlay')?.addEventListener('click', (e) => {
            if (e.target.id === 'modalOverlay') closeModal();
        });
    }

    getProductIcon(category) {
        const icons = {
            'vermicompost': 'üå±',
            'poultry_waste': 'üêî',
            'coconut_husk': 'ü••',
            'dry_leaves': 'üçÇ',
            'default': 'üì¶'
        };
        return icons[category] || icons.default;
    }

    showAlert(elementId, message, type) {
        const alert = document.getElementById(elementId);
        if (!alert) return;
        
        alert.className = `alert alert-${type}`;
        alert.textContent = message;
        alert.style.display = 'block';
        
        setTimeout(() => {
            alert.style.display = 'none';
        }, 5000);
    }
}

// Initialize app
let app;
document.addEventListener('DOMContentLoaded', () => {
    app = new VermaFarmApp();
});
    </script>
</body>
</html>